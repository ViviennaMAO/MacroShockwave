# MacroShockwave 产品需求文档 (PRD) - 详细版

## 文档信息
- **产品名称**：MacroShockwave (Luffa Mini-Program)
- **版本**：V1.0.0
- **文档状态**：详细版
- **最后更新**：2026-01-17
- **产品经理**：待定
- **技术负责人**：待定

---

## 1. 产品概述

### 1.1 产品定位
MacroShockwave 是一个基于 Luffa 平台的卡片式、游戏化比特币价格预测市场小程序，聚焦于重要宏观经济数据发布时刻，让用户通过预测数据对比特币价格的影响来参与市场博弈。

### 1.2 核心价值
- **实时性**：抓住 CPI、NFP、GDP 等重大宏观事件发布的关键时刻
- **多样性**：提供三种不同风险等级和玩法的下注方式
- **透明性**：基于区块链的公平结算机制
- **社交性**：通过 Luffa 生态实现分享和社群互动

### 1.3 目标用户
- 加密货币投资者
- 宏观经济数据关注者
- 短期交易爱好者
- 风险偏好型用户

---

## 2. 功能需求详细说明

### 2.1 Shockwave 冲击波下注面板

#### 2.1.1 事件列表展示
**功能描述**：
- 展示即将发布的宏观经济事件列表
- 按时间顺序排列，最近的事件排在最前
- 每个事件以卡片形式展示

**事件卡片信息**：
```
┌─────────────────────────────────────┐
│ 🔔 CPI (消费者物价指数)              │
│ ────────────────────────────────── │
│ 📅 发布时间: 2026-02-14 21:30 UTC  │
│ ⏱️  倒计时: 2天 15小时 23分钟        │
│ 📊 预期值: 3.2%                     │
│ 📈 前值: 3.4%                       │
│ 💰 总下注池: 12,450 USDT           │
│ 👥 参与人数: 245                    │
│ ────────────────────────────────── │
│ [ 立即参与 ]                        │
└─────────────────────────────────────┘
```

**支持的事件类型**：
1. **CPI (消费者物价指数)**
   - 发布频率：每月
   - 重要程度：⭐⭐⭐⭐⭐
   - 影响说明：衡量通货膨胀的关键指标

2. **NFP (非农就业数据)**
   - 发布频率：每月第一个周五
   - 重要程度：⭐⭐⭐⭐⭐
   - 影响说明：美国就业市场健康度指标

3. **GDP (国内生产总值)**
   - 发布频率：每季度
   - 重要程度：⭐⭐⭐⭐
   - 影响说明：经济增长速度指标

4. **Fed Rate Decision (美联储利率决议)**
   - 发布频率：每年8次
   - 重要程度：⭐⭐⭐⭐⭐
   - 影响说明：货币政策方向核心指标

**事件状态管理**：
```
[待开放] → [下注中] → [即将锁定] → [已锁定] → [数据发布] → [结算中] → [已结算]
    ↓          ↓           ↓          ↓          ↓          ↓          ↓
  灰色显示   可下注    红色闪烁     禁止下注   等待数据    计算中     显示结果
```

#### 2.1.2 玩法 A：数据狙击手 (Data Sniper)

**核心逻辑**：
用户预测公布值与预期值的关系，判断数据是鸽派、中性还是鹰派。

**下注选项**：
```
┌─────────────────────────────────────┐
│ 🎯 数据狙击手 (Data Sniper)          │
│ ────────────────────────────────── │
│ 选择你的预测：                       │
│                                     │
│ 🕊️ 鸽派 (Dovish)                    │
│ 公布值 < 预期值                      │
│ 当前赔率: 2.3x                       │
│ 下注占比: 35%                        │
│ [ ━━━━━━━                    ] 35% │
│                                     │
│ ⚖️ 中性 (Neutral)                   │
│ 公布值 = 预期值                      │
│ 当前赔率: 4.1x                       │
│ 下注占比: 15%                        │
│ [ ━━━                         ] 15% │
│                                     │
│ 🦅 鹰派 (Hawkish)                   │
│ 公布值 > 预期值                      │
│ 当前赔率: 1.8x                       │
│ 下注占比: 50%                        │
│ [ ━━━━━━━━━━                 ] 50% │
│                                     │
│ 下注金额: [___________] USDT        │
│ 预计收益: 0.00 USDT                 │
│                                     │
│ [ 确认下注 ]                        │
└─────────────────────────────────────┘
```

**赔率计算规则 (Pari-mutuel 模式)**：
- 总奖池 = 所有玩家下注总额 × (1 - 手续费率)
- 手续费率 = 3%
- 赔率 = 总奖池 / 该选项下注总额
- 实时动态更新赔率
- 用户下注时看到预估赔率，实际赔率以下注截止时为准

**奖金分配规则**：
```javascript
// 获胜用户瓜分奖金池
用户获得奖金 = (用户下注额 / 获胜选项总下注额) × 总奖金池
用户收益 = 用户获得奖金 - 用户下注额

// 示例：
假设鹰派获胜，鹰派总下注 15,000 USDT
用户 A 下注 1,500 USDT
总奖金池 29,100 USDT (已扣 3% 手续费)

用户 A 获得 = (1,500 / 15,000) × 29,100 = 2,910 USDT
用户 A 收益 = 2,910 - 1,500 = 1,410 USDT (94% ROI)
```

**重要说明**：
- ⚠️ 下注后不可修改或取消
- ⚠️ 赔率实时变动，以下注截止时为准
- ✅ 可在不同选项下注（对冲策略）

**判定标准**：
```javascript
// 伪代码示例
if (公布值 < 预期值 - 容差) {
  结果 = "鸽派"
} else if (公布值 > 预期值 + 容差) {
  结果 = "鹰派"
} else {
  结果 = "中性"
}

// 容差标准（根据数据类型）
容差 = {
  CPI: 0.1%,
  NFP: 10K,
  GDP: 0.1%,
  FedRate: 0.0% (精确匹配)
}
```

#### 2.1.3 玩法 B：波动猎人 (Volatility Hunter)

**核心逻辑**：
不预测方向，只预测波动幅度大小。降低难度，适合风险厌恶型用户。

**下注选项**：
```
┌─────────────────────────────────────┐
│ 🌊 波动猎人 (Volatility Hunter)      │
│ ────────────────────────────────── │
│ 预测 BTC 价格波动幅度：              │
│                                     │
│ 🌤️ 风平浪静 (Calm)                  │
│ 波动 < 2%                           │
│ 当前赔率: 3.2x                       │
│ 下注占比: 30%                        │
│                                     │
│ 🌊 惊涛骇浪 (Storm)                 │
│ 波动 ≥ 2%                           │
│ 当前赔率: 1.5x                       │
│ 下注占比: 70%                        │
│                                     │
│ 下注金额: [___________] USDT        │
│ 预计收益: 0.00 USDT                 │
│                                     │
│ [ 确认下注 ]                        │
└─────────────────────────────────────┘
```

**波动计算规则**：
```javascript
// 结算时刻的价格采样
基准价格 = 数据发布前 1 分钟的 BTC 价格
结算价格 = 数据发布后 15 分钟的 BTC 价格

// 波动幅度计算
波动幅度 = |结算价格 - 基准价格| / 基准价格 × 100%

// 判定
if (波动幅度 < 2%) {
  结果 = "风平浪静"
} else {
  结果 = "惊涛骇浪"
}
```

**价格数据源**：
- 优先使用：Binance BTC/USDT 现货价格
- 备用数据源：Coinbase, Kraken
- 采用中位数防止异常波动

#### 2.1.4 玩法 C：精准点位 (Jackpot)

**核心逻辑**：
预测结算时刻的精确价格区间，高风险高回报的彩票玩法。

**下注界面**：
```
┌─────────────────────────────────────┐
│ 🎰 精准点位 (Jackpot)                │
│ ────────────────────────────────── │
│ 当前 BTC 价格: $48,523              │
│                                     │
│ 选择价格区间 (15分钟后结算价)：      │
│                                     │
│ ┌─────────────────────────────┐   │
│ │ < $46,000      赔率: 85x    │   │
│ │ $46,000-47,000 赔率: 45x    │   │
│ │ $47,000-48,000 赔率: 12x    │   │
│ │ $48,000-49,000 赔率: 8x  ⭐ │   │
│ │ $49,000-50,000 赔率: 15x    │   │
│ │ $50,000-51,000 赔率: 52x    │   │
│ │ > $51,000      赔率: 120x   │   │
│ └─────────────────────────────┘   │
│                                     │
│ 下注金额: [___________] USDT        │
│ 潜在收益: 0.00 USDT (最高 100x!)   │
│                                     │
│ [ 确认下注 ]                        │
└─────────────────────────────────────┘
```

**区间划分规则**：
- 以当前价格为中心
- 共 7 个价格区间
- 区间宽度：$1,000
- 远离当前价的区间赔率更高
- 动态调整区间范围（根据当前价格）

**最高赔率限制**：
- 单注最高赔率：100x
- 防止极端情况下的过度赔付

#### 2.1.5 下注规则与流程

**下注金额限制**：
```javascript
最小下注额 = 10 USDT          // 防止刷量
最大下注额 = 10,000 USDT      // 单笔单选项限制
单用户单事件总限额 = 50,000 USDT  // 所有玩法合计
单事件单玩法池上限 = 1,000,000 USDT // 达到后停止接受下注
```

**下注时间窗口**：
```
[待开放] → 事件发布前 7 天开放
[下注中] ← 可以下注
[即将锁定] ← 数据发布前 5 分钟，红色警告
[已锁定] ← 禁止下注
[数据发布] → [结算中] → [已结算]
```

**下注流程**：
```
1. 用户选择事件和玩法
   ↓
2. 选择预测选项
   ↓
3. 输入下注金额
   ↓ 前端验证
4. 验证金额限制
   - ✅ ≥ 10 USDT
   - ✅ ≤ 10,000 USDT
   - ✅ 用户总下注未超 50,000 USDT
   - ✅ 用户余额充足
   ↓
5. 显示预估收益和费用明细
   ↓ 用户确认
6. 调用 Luffa 钱包授权
   ↓
7. 发送链上交易（支付：下注额 + Gas 费）
   ↓
8. 等待交易确认（约 3-10 秒）
   ↓
9. 下注成功 ✅
   - 更新奖金池
   - 更新用户持仓
   - 实时更新赔率
```

**重要规则**：
```
❌ 下注后不可修改
❌ 下注后不可取消
✅ 可在同一事件追加新下注（遵守总额限制）
✅ 可在不同选项下注（对冲策略）
✅ 可在不同玩法下注
```

**交易确认**：
```
┌─────────────────────────────────────┐
│ ⏳ 交易处理中...                     │
│                                     │
│ 📝 交易详情：                        │
│ 事件: CPI 2026-02-14                │
│ 玩法: 数据狙击手                     │
│ 预测: 鸽派 (Dovish)                  │
│ 下注: 100 USDT                      │
│ 预计收益: 230 USDT (2.3x)           │
│                                     │
│ 🔗 交易哈希: 0x7a3f...              │
│                                     │
│ [ 查看区块浏览器 ]                   │
└─────────────────────────────────────┘
```

#### 2.1.6 结算规则详细说明

**结算触发条件**：
```javascript
结算必须满足以下所有条件：
1. 官方数据已正式发布
2. 数据来源已通过 Oracle 验证
3. BTC 价格已稳定（15 分钟后）
4. 多数据源确认一致（至少 3/5 Oracle 节点）

时间线：
数据发布 (T0)
  ↓ 等待 15 分钟
价格采样 (T0 + 15min)
  ↓ Oracle 提交数据
链上验证 (3/5 节点确认)
  ↓ 智能合约计算
分配奖金 (自动转入用户钱包)
```

**无人中奖退款机制**：
```
仅适用于「玩法 C：精准点位」

如果中奖区间无人下注：
✅ 所有用户获得 100% 本金退回
✅ 平台不收取手续费
❌ 不补偿 Gas 费（用户自行承担）

退款流程：
智能合约检测无人中奖 → 自动触发退款 → 原路退回下注金额
→ 更新订单状态为「已退款」
```

**手续费收取**：
```
平台手续费率 = 3%
收取方式 = 从总奖金池扣除

费用分配：
├─ 1.5% → 运营成本（服务器、数据源、维护）
├─ 1.0% → 保险基金（应对极端情况）
└─ 0.5% → 治理基金（DAO 预留）

用户支付：
- 下注金额（进入奖金池）
- Gas 费（约 0.5 USDT，用户自行承担）
```

**结算时间保证**：
```
正常情况：数据发布后 15-20 分钟完成结算
异常情况：最多不超过 24 小时

超时处理：
- 数据源延迟：等待最多 2 小时
- 多数据源冲突：人工介入审核
- Oracle 故障：启用备用 Oracle
- 超过 24 小时：启用紧急多签结算
```

**奖金提取**：
```
自动提取（默认，推荐）：
✅ 结算后自动转入用户钱包
✅ 无需用户操作
✅ 节省 Gas 费（批量处理）

手动提取（可选）：
⚠️ 用户需主动点击"提取"
⚠️ 单独支付 Gas 费
✅ 用户自主控制
```

**特殊情况处理**：
```
1. 数据未发布或延迟 (< 24h)
   → 等待数据，延长结算时间

2. 数据长时间延迟 (> 24h)
   → 平台发起投票，决定等待或退款

3. 数据取消发布
   → 全额退款所有用户，不收手续费

4. 极端市场波动 (BTC 单日 > 30%)
   → 延长结算至价格稳定
   → 多数据源交叉验证
   → 必要时人工审核

5. Oracle 故障
   → 启用备用 Oracle (Chainlink → Band Protocol → API3)
   → 最后选项：人工多签提交
```

**结算争议机制**：
```
用户可在结算后 24 小时内提交争议
  ↓
平台审核团队调查（调取多数据源证据）
  ↓
3 个工作日内给出结论
  ↓
确认错误：重新结算 + 补偿
无误：维持原结果
```

**详细规则文档**：
完整的下注与结算规则请参考：`下注与结算规则详细说明.md`

### 2.2 投资组合页面 (Portfolio)

#### 2.2.1 概览卡片

**资产概览**：
```
┌─────────────────────────────────────┐
│ 💼 投资组合                          │
│ ────────────────────────────────── │
│ 总价值                               │
│ $15,234.50                          │
│ +$1,234.50 (+8.83%) 24h            │
│                                     │
│ 现金余额        未结订单价值          │
│ $5,234.50       $10,000.00         │
│                                     │
│ 盈亏统计 [ 1D | 1W | 1M | ALL ]     │
│ ┌─────────────────────────────┐   │
│ │     📈                      │   │
│ │    ╱                        │   │
│ │   ╱                         │   │
│ │  ╱                          │   │
│ │ ╱                           │   │
│ └─────────────────────────────┘   │
│                                     │
│ 总收益: +$3,450.00 (+29.3%)        │
│ 胜率: 62.5% (25/40)                │
└─────────────────────────────────────┘
```

**时间筛选器**：
- 1D (24小时)
- 1W (7天)
- 1M (30天)
- ALL (全部时间)

**统计指标**：
- 总投资组合价值
- 24小时涨跌
- 现金余额
- 未结订单价值
- 总收益 / 总收益率
- 胜率（成功预测次数 / 总预测次数）

#### 2.2.2 持仓管理标签页

**Tab 切换**：
```
[ Positions ] [ Open Orders ] [ History ]
     ▔▔▔
```

**2.2.2.1 Positions (当前持仓)**

展示用户当前持有的未结算订单：

```
┌──────────────────────────────────────────────────────────┐
│ MARKET         AVG → NOW      BET      TO WIN     VALUE   │
├──────────────────────────────────────────────────────────┤
│ CPI 02/14      鸽派 2.3x     100      230        100      │
│ 数据狙击手      锁定中        USDT     USDT       USDT     │
│ ⏱️ 1天 5小时后结算                                        │
├──────────────────────────────────────────────────────────┤
│ NFP 02/07      波动>2%       200      300        200      │
│ 波动猎人        1.5x          USDT     USDT       USDT     │
│ ⏱️ 12小时后结算                                           │
├──────────────────────────────────────────────────────────┤
│ GDP Q4         $48-49K       50       400        50       │
│ 精准点位        8.0x          USDT     USDT       USDT     │
│ ⏱️ 3天后结算                                              │
└──────────────────────────────────────────────────────────┘
```

**字段说明**：
- **MARKET**：事件名称 + 日期
- **AVG → NOW**：下注选项 + 当前赔率
- **BET**：下注金额
- **TO WIN**：潜在收益（含本金）
- **VALUE**：当前价值（下注前为本金，结算后为实际收益）

**交互功能**：
- 点击展开详情
- 查看实时赔率变化
- 查看该事件的实时数据

**2.2.2.2 Open Orders (未结订单)**

与 Positions 相同，展示所有未结算的订单。

**排序选项**：
- 按时间（最近下注）
- 按金额（最大下注）
- 按潜在收益（最高收益）

**2.2.2.3 History (历史记录)**

展示已结算的所有订单：

```
┌──────────────────────────────────────────────────────────────┐
│ MARKET         结果          BET      收益       状态    日期  │
├──────────────────────────────────────────────────────────────┤
│ CPI 01/14      鹰派          100      ❌ -100    失败   01/14 │
│ 数据狙击手      实际:鹰派     USDT     USDT               21:30│
│ 预测:鸽派                                                     │
├──────────────────────────────────────────────────────────────┤
│ NFP 01/03      波动 3.2%    200      ✅ +300    成功   01/03 │
│ 波动猎人        预测:>2%     USDT     USDT               21:30│
├──────────────────────────────────────────────────────────────┤
│ GDP Q3         $47.2K       50       ❌ -50     失败   12/28 │
│ 精准点位        预测:$48-49K USDT     USDT               20:00│
└──────────────────────────────────────────────────────────────┘

总计 40 笔订单 | 胜率: 62.5% | 总盈亏: +$3,450
```

**筛选器**：
- 按状态：全部 / 成功 / 失败
- 按玩法：全部 / 数据狙击手 / 波动猎人 / 精准点位
- 按事件类型：全部 / CPI / NFP / GDP / Fed Rate
- 按时间范围：1W / 1M / 3M / 1Y / ALL

**导出功能**：
- 导出 CSV 格式交易记录
- 分享到 Luffa 群聊

### 2.3 用户系统 (Profile)

#### 2.3.1 认证方式

**登录流程**：
```
1. 用户打开小程序
   ↓
2. 检测 Luffa 环境
   ↓
3. 调用 luffa.getAccount()
   ↓
4. 获取用户地址和用户信息
   ↓
5. 自动登录，无需额外注册
```

**用户信息获取**：
```javascript
// 伪代码
const userInfo = await luffa.getAccount();
// 返回:
{
  address: "0x1234...5678",
  username: "CryptoTrader",
  avatar: "https://avatar.url/user.png"
}
```

#### 2.3.2 用户界面

**顶部导航栏（未登录）**：
```
┌────────────────────────────────────┐
│ 🌊 MacroShockwave    [ 连接钱包 ]  │
└────────────────────────────────────┘
```

**顶部导航栏（已登录）**：
```
┌────────────────────────────────────┐
│ 🌊 MacroShockwave    👤 @username  │
│                      [ 登出 ]      │
└────────────────────────────────────┘
```

**个人资料页**：
```
┌─────────────────────────────────────┐
│           👤                         │
│       @CryptoTrader                  │
│   0x1234...5678 📋                  │
│                                     │
│ ────────────────────────────────── │
│                                     │
│ 📊 交易统计                          │
│ 总下注: 40 笔                        │
│ 胜率: 62.5%                         │
│ 总盈亏: +$3,450 (+29.3%)           │
│ 最佳单笔: +$800 (CPI 12/14)        │
│                                     │
│ 🏆 成就徽章                          │
│ [🎯] 首次预测                       │
│ [📈] 连胜 5 次                      │
│ [💎] 累计盈利 $1000+               │
│                                     │
│ ⚙️ 设置                             │
│ [ 通知设置 ]                        │
│ [ 语言切换 ]                        │
│ [ 关于我们 ]                        │
│                                     │
│ [ 登出 ]                            │
└─────────────────────────────────────┘
```

#### 2.3.3 通知设置

**通知类型**：
- [ ] 事件即将开始（提前 1 小时）
- [ ] 下注即将截止（提前 10 分钟）
- [ ] 数据已发布
- [ ] 订单已结算
- [ ] 每日盈亏报告

**通知方式**：
- Luffa 应用内推送

---

## 3. 技术需求详细说明

### 3.1 Luffa SDK 集成

#### 3.1.1 环境配置

**SDK 引入**：
```html
<!-- 在 index.html 中引入 Luffa SDK -->
<script src="https://luffa.im/sdk/superbox-mini-sdk.js"></script>
```

**初始化**：
```javascript
// 初始化 Luffa 环境
window.addEventListener('load', async () => {
  if (typeof luffa !== 'undefined') {
    console.log('Luffa environment detected');
    await initLuffa();
  } else {
    console.error('Not running in Luffa environment');
  }
});
```

#### 3.1.2 钱包连接

**获取账户信息**：
```javascript
async function getAccount() {
  try {
    const account = await luffa.getAccount();
    return {
      address: account.address,
      username: account.username,
      avatar: account.avatar
    };
  } catch (error) {
    console.error('Failed to get account:', error);
    return null;
  }
}
```

**监听账户变化**：
```javascript
luffa.on('accountChanged', (newAccount) => {
  console.log('Account changed:', newAccount);
  // 更新应用状态
  updateUserInfo(newAccount);
});
```

#### 3.1.3 链上交互

**发送交易**：
```javascript
async function placeBet(eventId, betType, option, amount) {
  try {
    const tx = await luffa.sendTransaction({
      to: CONTRACT_ADDRESS,
      data: encodeBetData(eventId, betType, option, amount),
      value: amount
    });

    return {
      success: true,
      txHash: tx.hash
    };
  } catch (error) {
    console.error('Transaction failed:', error);
    return {
      success: false,
      error: error.message
    };
  }
}
```

**监听交易状态**：
```javascript
luffa.on('transactionConfirmed', (txHash) => {
  console.log('Transaction confirmed:', txHash);
  // 更新订单状态
  updateOrderStatus(txHash, 'confirmed');
});
```

#### 3.1.4 分享功能

**设置分享信息**：
```javascript
function setShareInfo(eventData) {
  luffa.setShareInfo({
    title: `我在 ${eventData.name} 下注了 ${eventData.amount} USDT!`,
    description: `预测: ${eventData.prediction}, 潜在收益: ${eventData.potentialWin} USDT`,
    imageUrl: generateShareImage(eventData),
    path: `/event/${eventData.id}`
  });
}
```

**生成分享图片**：
- 包含事件信息
- 用户预测
- 当前赔率
- MacroShockwave 品牌元素

### 3.2 技术架构

#### 3.2.1 前端技术栈

**核心框架**：
- React 18+ / Vue 3+ (推荐 React)
- TypeScript
- Tailwind CSS (样式)

**状态管理**：
- Zustand / Redux Toolkit

**UI 组件库**：
- Radix UI / Headless UI (无样式组件)
- Framer Motion (动画)

**图表库**：
- Recharts / Chart.js (盈亏图表)

**工具库**：
- date-fns (时间处理)
- ethers.js / web3.js (区块链交互)

#### 3.2.2 后端架构

**API 服务**：
- Node.js + Express / Nest.js
- RESTful API 设计

**数据库**：
- PostgreSQL (关系型数据)
  - 用户信息
  - 订单记录
  - 事件数据

- Redis (缓存)
  - 实时赔率
  - 倒计时
  - 用户会话

**区块链交互**：
- 智能合约 (Solidity)
- Hardhat / Foundry (开发框架)

**数据获取**：
- 定时任务获取宏观数据
- API 数据源：
  - Trading Economics
  - Federal Reserve
  - Bureau of Labor Statistics

**价格数据源**：
- WebSocket 连接 Binance API
- 备用：Coinbase, Kraken API

#### 3.2.3 智能合约设计

**合约功能**：
```solidity
// 伪代码
contract MacroShockwave {
  // 下注
  function placeBet(
    uint256 eventId,
    BetType betType,
    uint8 option,
    uint256 amount
  ) external payable;

  // 结算
  function settleEvent(
    uint256 eventId,
    bytes calldata result
  ) external onlyOracle;

  // 提取奖金
  function claimWinnings(uint256 orderId) external;

  // 查询订单
  function getOrder(uint256 orderId) external view returns (Order memory);

  // 查询事件
  function getEvent(uint256 eventId) external view returns (Event memory);
}
```

**安全机制**：
- ReentrancyGuard (防止重入攻击)
- Pausable (紧急暂停)
- AccessControl (权限管理)
- Oracle 多签验证

### 3.3 响应式设计

**适配要求**：
- 主要适配移动端
- 最小宽度：320px (iPhone SE)
- 最大宽度：428px (iPhone 14 Pro Max)

**断点设置**：
```css
/* Tailwind config */
screens: {
  'xs': '320px',
  'sm': '375px',
  'md': '414px',
  'lg': '428px',
}
```

### 3.4 性能优化

**加载优化**：
- 懒加载非关键组件
- 图片压缩和 WebP 格式
- 代码分割 (Code Splitting)
- 骨架屏 (Skeleton Screen)

**缓存策略**：
- Service Worker 缓存静态资源
- Redis 缓存实时数据
- CDN 分发

**目标性能指标**：
- 首屏加载时间 < 2s
- 页面切换动画 60fps
- API 响应时间 < 500ms

---

## 4. UI/UX 设计规范

### 4.1 设计主题

#### 4.1.1 色彩系统

**主色调**：
```css
:root {
  /* 品牌色 */
  --primary: #8b5cf6;        /* 紫色 */
  --secondary: #3b82f6;      /* 蓝色 */
  --accent: #06b6d4;         /* 青色 */

  /* 功能色 */
  --success: #10b981;        /* 绿色 - 上涨/利好 */
  --danger: #ef4444;         /* 红色 - 下跌/利空 */
  --warning: #f59e0b;        /* 橙色 - 警告 */
  --info: #3b82f6;           /* 蓝色 - 信息 */

  /* 背景色 */
  --bg-primary: #0a0a0f;     /* 深黑 */
  --bg-secondary: #1a1a24;   /* 次级背景 */
  --bg-card: rgba(255, 255, 255, 0.05); /* 卡片背景 */

  /* 文本色 */
  --text-primary: #ffffff;
  --text-secondary: #a0a0b0;
  --text-tertiary: #606070;

  /* 边框色 */
  --border: rgba(255, 255, 255, 0.1);
}
```

**渐变色**：
```css
/* 主渐变 */
.gradient-primary {
  background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 50%, #06b6d4 100%);
}

/* 卡片渐变 */
.gradient-card {
  background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
}

/* 按钮渐变 */
.gradient-button {
  background: linear-gradient(90deg, #8b5cf6 0%, #3b82f6 100%);
}
```

#### 4.1.2 玻璃拟态效果

**卡片样式**：
```css
.glass-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}
```

**按钮样式**：
```css
.glass-button {
  background: rgba(139, 92, 246, 0.2);
  backdrop-filter: blur(5px);
  border: 1px solid rgba(139, 92, 246, 0.3);
  border-radius: 12px;
  transition: all 0.3s ease;
}

.glass-button:hover {
  background: rgba(139, 92, 246, 0.3);
  border-color: rgba(139, 92, 246, 0.5);
  transform: translateY(-2px);
}
```

### 4.2 排版规范

**字体**：
```css
:root {
  --font-primary: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  --font-mono: 'SF Mono', 'Monaco', 'Courier New', monospace;
}
```

**字号**：
```css
:root {
  --text-xs: 12px;
  --text-sm: 14px;
  --text-base: 16px;
  --text-lg: 18px;
  --text-xl: 20px;
  --text-2xl: 24px;
  --text-3xl: 30px;
  --text-4xl: 36px;
}
```

**行高**：
```css
:root {
  --leading-tight: 1.25;
  --leading-normal: 1.5;
  --leading-relaxed: 1.75;
}
```

### 4.3 动效规范

#### 4.3.1 页面切换

```css
/* 渐入动画 */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.page-enter {
  animation: fadeIn 0.3s ease-out;
}
```

#### 4.3.2 卡片 Hover

```css
.card {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px 0 rgba(139, 92, 246, 0.3);
}
```

#### 4.3.3 倒计时动画

```css
@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.countdown-urgent {
  animation: pulse 1s ease-in-out infinite;
  color: var(--danger);
}
```

#### 4.3.4 Loading 动画

```css
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loading-spinner {
  animation: spin 1s linear infinite;
}
```

**骨架屏**：
```css
@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
}

.skeleton {
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.05) 25%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(255, 255, 255, 0.05) 75%
  );
  background-size: 2000px 100%;
  animation: shimmer 2s infinite;
}
```

### 4.4 组件库

#### 4.4.1 按钮组件

```
主要按钮 (Primary)
[ 确认下注 ]

次要按钮 (Secondary)
[ 取消 ]

危险按钮 (Danger)
[ 登出 ]

禁用按钮 (Disabled)
[ 已截止 ]
```

#### 4.4.2 输入框

```
┌─────────────────────────┐
│ 💵 下注金额 (USDT)      │
│ [_________________]     │
│ 余额: 5,234.50 USDT    │
└─────────────────────────┘
```

#### 4.4.3 Toast 通知

```
┌─────────────────────────┐
│ ✅ 下注成功！            │
│ 您已成功下注 100 USDT   │
└─────────────────────────┘

┌─────────────────────────┐
│ ❌ 下注失败              │
│ 余额不足，请充值        │
└─────────────────────────┘
```

#### 4.4.4 Modal 弹窗

```
┌─────────────────────────────────┐
│                                 │
│      ⚠️ 确认下注                │
│                                 │
│  事件: CPI 2026-02-14           │
│  玩法: 数据狙击手               │
│  预测: 鸽派                     │
│  金额: 100 USDT                │
│  预计收益: 230 USDT (2.3x)     │
│                                 │
│  [ 取消 ]  [ 确认 ]            │
│                                 │
└─────────────────────────────────┘
```

---

## 5. 数据流设计

### 5.1 事件数据流

```
外部数据源 → 后端定时任务 → 数据库 → API → 前端展示
    ↓
预期值、前值、发布时间
    ↓
结算时获取公布值
    ↓
触发智能合约结算
    ↓
更新用户订单状态
```

### 5.2 下注数据流

```
用户输入 → 前端验证 → 调用 Luffa SDK → 链上交易
    ↓                                      ↓
显示 Loading                         交易确认
    ↓                                      ↓
后端监听事件                         更新数据库
    ↓                                      ↓
实时更新赔率                         通知用户
```

### 5.3 结算数据流

```
数据发布 → Oracle 获取 → 提交链上 → 合约验证
    ↓                                  ↓
15分钟延迟                         计算结果
    ↓                                  ↓
获取 BTC 价格                      分配奖金
    ↓                                  ↓
最终结算                           用户可提取
```

---

## 6. 安全性设计

### 6.1 智能合约安全

**审计要求**：
- 第三方安全审计（CertiK, SlowMist）
- 开源代码
- 测试覆盖率 > 95%

**安全措施**：
- 防重入攻击
- 整数溢出保护
- 权限控制
- 紧急暂停机制
- 多签管理

### 6.2 数据安全

**API 安全**：
- HTTPS 加密传输
- API 签名验证
- 频率限制（Rate Limiting）
- IP 白名单（管理接口）

**数据库安全**：
- 敏感数据加密存储
- SQL 注入防护
- 定期备份
- 访问权限控制

### 6.3 用户安全

**钱包安全**：
- 用户自托管钱包
- 不存储私钥
- 交易签名验证

**金额限制**：
- 单笔最大下注
- 单日最大下注
- 异常检测和风控

---

## 7. 运营与增长

### 7.1 初期运营策略

**用户获取**：
- Luffa 生态内推广
- 空投活动（首次下注奖励）
- 推荐返佣机制

**用户留存**：
- 每日签到奖励
- 成就系统
- 排行榜（周榜、月榜）
- VIP 等级体系

### 7.2 数据分析

**关键指标**：
- DAU / MAU (日活 / 月活)
- 用户留存率 (D1, D7, D30)
- 下注转化率
- ARPU (每用户平均收入)
- 分享率

**分析工具**：
- Google Analytics
- Mixpanel
- 自建数据看板

### 7.3 社区建设

**社交功能**（V2 规划）：
- 用户关注系统
- 预测复制（跟单）
- 群聊讨论
- 实时评论

---

## 8. 开发计划

### 8.1 MVP (最小可行产品)

**Phase 1 (4周)**：
- [ ] Luffa SDK 集成
- [ ] 用户登录系统
- [ ] 事件列表展示
- [ ] 玩法 A：数据狙击手
- [ ] 基础下注流程
- [ ] 投资组合页面（仅 Positions）

**Phase 2 (3周)**：
- [ ] 玩法 B：波动猎人
- [ ] 玩法 C：精准点位
- [ ] 完整持仓管理（Open Orders, History）
- [ ] 智能合约开发
- [ ] 测试网部署

**Phase 3 (2周)**：
- [ ] UI/UX 优化
- [ ] 动画和交互优化
- [ ] 性能优化
- [ ] 安全审计
- [ ] 主网部署

### 8.2 后续迭代

**V1.1**：
- 更多事件类型（失业率、零售销售等）
- 推荐返佣系统
- 成就徽章

**V1.2**：
- 社交功能
- 排行榜
- VIP 系统

**V2.0**：
- 跟单功能
- 策略分享
- DAO 治理

---

## 9. 风险与挑战

### 9.1 技术风险

- **数据源可靠性**：宏观数据发布延迟或错误
  - **应对**：多数据源验证，人工审核

- **价格操纵**：结算时刻价格被操纵
  - **应对**：多交易所价格取中位数，15分钟延迟结算

- **智能合约漏洞**：合约被攻击
  - **应对**：多次审计，bug bounty，保险基金

### 9.2 业务风险

- **流动性不足**：初期用户少，奖池小
  - **应对**：平台补贴，保底奖池

- **监管风险**：博弈类产品监管
  - **应对**：合规咨询，限制地区

- **用户体验**：区块链交易慢
  - **应对**：Layer 2 方案，乐观更新

### 9.3 运营风险

- **用户流失**：新鲜感过后离开
  - **应对**：持续增加新事件，游戏化运营

- **竞争压力**：类似产品出现
  - **应对**：快速迭代，建立品牌

---

## 10. 成功指标

### 10.1 上线 1 个月目标

- DAU: 500+
- 总下注金额: $100,000+
- 用户留存率 (D7): 30%+
- 平均下注额: $50+

### 10.2 上线 3 个月目标

- DAU: 2,000+
- 总下注金额: $1,000,000+
- 用户留存率 (D30): 20%+
- 付费转化率: 40%+

### 10.3 上线 6 个月目标

- DAU: 5,000+
- 总下注金额: $5,000,000+
- MAU: 20,000+
- 社区用户数: 10,000+

---

## 11. 附录

### 11.1 术语表

- **Pari-mutuel**：同注分彩系统，赔率由总奖池和各选项下注比例动态决定
- **Oracle**：预言机，将链外数据传递到链上的服务
- **Glassmorphism**：玻璃拟态设计风格，使用模糊背景和半透明效果
- **CPI**：消费者物价指数 (Consumer Price Index)
- **NFP**：非农就业数据 (Non-Farm Payrolls)
- **GDP**：国内生产总值 (Gross Domestic Product)

### 11.2 参考资料

- [Luffa SuperBox 开发指南](https://luffa.im/SuperBox/docs/hk/miniProDevelopmentGuide/Introduction.html)
- [Polymarket](https://polymarket.com) - 预测市场参考
- [Kalshi](https://kalshi.com) - 事件合约参考

### 11.3 更新日志

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|---------|------|
| 1.0 | 2026-01-17 | 初版 PRD 详细版完成 | - |

---

**文档结束**
